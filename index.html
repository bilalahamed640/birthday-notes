<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Birthday Notes üéÇ</title>
  <style>
    :root{--accent:#ff4081;--card-bg:#ffffff;--soft:#fff5f8}
    html,body{height:100%;margin:0}
    body{font-family:Inter, Poppins, Arial, sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100vh;color:#333}
    .bg{position:fixed;inset:0;z-index:-3;background:linear-gradient(120deg,#ffe6f0,#fff9e6);animation:bgShift 12s ease-in-out infinite}
    @keyframes bgShift{0%{background:linear-gradient(120deg,#ffe6f0,#fff9e6)}50%{background:linear-gradient(120deg,#fff9e6,#e6f7ff)}100%{background:linear-gradient(120deg,#ffe6f0,#fff9e6)}}

    /* scattered emoji background */
    .emoji-bg {position:fixed;inset:0;z-index:-2;pointer-events:none;overflow:hidden}
    .emoji-bg span {position:absolute;font-size:24px;opacity:0.12;animation:floaty 14s infinite ease-in-out}
    @keyframes floaty {0%{transform:translateY(0px) rotate(0deg);}50%{transform:translateY(-22px) rotate(12deg);}100%{transform:translateY(0px) rotate(0deg);}}

    header{width:100%;max-width:1100px;padding:18px;display:flex;flex-direction:column;align-items:center;margin-top:16px;background:rgba(255,255,255,0.72);backdrop-filter:blur(8px);border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
    h1{margin:0;font-size:22px;background:linear-gradient(90deg,#ff4081,#ff9800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;display:inline-flex;align-items:center;gap:8px}
    #musicIndicator{font-size:18px;opacity:0.6;transition:transform .25s,box-shadow .25s,opacity .25s}
    #musicIndicator.on{transform:scale(1.18);box-shadow:0 0 14px rgba(255,64,129,0.65);opacity:1}

    .meta{display:flex;gap:12px;align-items:center;margin-top:12px}
    #countdown{font-weight:600;color:#444}
    #progressWrap{width:100%;max-width:760px;margin-top:14px}
    .progress{height:10px;background:rgba(0,0,0,0.06);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ff98c8);width:0%;transition:width 600ms ease}
    .container{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;padding:22px;max-width:1100px;width:100%;box-sizing:border-box}
    .cardWrap{perspective:1000px}
    .card{background:var(--card-bg);border-radius:14px;padding:18px;text-align:center;box-shadow:0 8px 26px rgba(17,12,38,0.06);cursor:pointer;position:relative;overflow:visible;min-height:120px;transform-style:preserve-3d;transition:transform .7s cubic-bezier(.2,.9,.3,1)}
    .card.flipped{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;border-radius:14px;backface-visibility:hidden}
    .front{background:var(--card-bg)}
    .back{transform:rotateY(180deg);background:linear-gradient(180deg,#fff,#fff7fb)}
    .card h3{margin:0;font-size:16px}
    .card p{margin-top:8px;color:#444;font-size:15px;line-height:1.3}
    .badge {position: absolute;top: 12px;right: 12px;background: rgba(255,64,129,0.12);color: var(--accent);padding: 6px 8px;border-radius: 999px;font-size: 13px;transform: rotateY(0deg);backface-visibility: hidden;z-index: 3}
    .emoji{position:fixed;pointer-events:none;z-index:9999;will-change:transform,opacity}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:9998;opacity:0;pointer-events:none;transition:opacity .3s}
    .overlay.show{opacity:1;pointer-events:auto}
    .overlay .box{background:linear-gradient(90deg,#fff,#fff7fb);padding:30px 36px;border-radius:14px;text-align:center;box-shadow:0 18px 50px rgba(0,0,0,0.25)}
    .overlay h2{margin:0 0 8px;color:var(--accent);font-size:28px}
    footer{margin:26px 0 46px;color:#777}

    /* Locked card blur effect with glow */
    .card.locked { pointer-events: none; position: relative; animation: pulseGlow 2.5s infinite; }
    .card.locked .face { filter: blur(4px) brightness(0.9); }
    .card.locked::after { content: "üîí"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.85); padding: 6px 12px; border-radius: 8px; font-weight: bold; color: var(--accent); z-index: 2; }
    @keyframes pulseGlow { 0%,100% { box-shadow: 0 0 10px rgba(255,64,129,0.3); } 50% { box-shadow: 0 0 22px rgba(255,64,129,0.6); } }

    /* debug panel (visible on localhost or with ?debug=1) */
    #debugPanel{position:fixed;left:12px;bottom:12px;background:rgba(0,0,0,0.7);color:#fff;padding:8px 10px;border-radius:8px;font-size:12px;z-index:10000;display:none}

    @media (max-width:520px){.card{min-height:140px}}
  </style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>
<div class="emoji-bg" aria-hidden="true"></div>
<header>
  <h1>üéâ Insarah‚Äôs Birthday Countdown <span id="musicIndicator" aria-hidden="true">üéµ</span></h1>
  <div class="meta">
    <div id="countdown">Starts Sep 19 ‚Äî <span id="daysLeft">loading...</span> left</div>
  </div>
  <div id="progressWrap">
    <div class="progress"><i id="progressBar"></i></div>
  </div>
</header>

<section class="container" id="notesContainer" aria-live="polite"></section>
<div class="overlay" id="birthdayOverlay">
  <div class="box">
    <h2>Happy Birthday! ‚ù§Ô∏è</h2>
    <p>Wishing you the most beautiful day ‚Äî with all my love.</p>
  </div>
</div>
<audio id="bgAudio" preload="auto"></audio>
<div id="debugPanel" aria-hidden="false"></div>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', ()=>{
    try{
      const preview = false; // set false before share ‚Äî keep false for countdown
      const nickname = "Chubby Cheek";

      const notes = [
        {date:'2025-09-19', title:"Couldn‚Äôt Wait üíå", text:"I couldn‚Äôt hold back ‚Äî you‚Äôre already on my mind. You have this rare way of making me feel like the luckiest person alive just by existing."},
        {date:'2025-09-20', title:"My Sunrise üåÖ", text:"You‚Äôre the light that chases away my shadows. The warmth you carry makes everything around you brighter ‚Äî especially me."},
        {date:'2025-09-21', title:"Your Smile üå∏", text:"That smile of yours‚Ä¶ it‚Äôs unfair how it owns my heart. It‚Äôs not just beautiful, it‚Äôs the kind of smile that heals people."},
        {date:'2025-09-22', title:"My Calm ü§ç", text:"The world feels noisy, but you bring me peace. You‚Äôre not only stunning outside, your calm heart is breathtaking too."},
        {date:'2025-09-23', title:"Little Sparkles ‚ú®", text:"Every laugh, every look, every little thing you do makes ordinary moments magical. You‚Äôre my favorite kind of sparkle."},
        {date:'2025-09-24', title:"My Safe Place üïäÔ∏è", text:"I find comfort in you. Your presence feels like home ‚Äî safe, warm, and exactly where I want to be."},
        {date:'2025-09-25', title:"Made of Magic üé®", text:"You turn ordinary days into stories worth remembering. That‚Äôs your magic ‚Äî and it never fails to amaze me."},
        {date:'2025-09-26', title:"The Way You Care üåø", text:"Your kindness leaves soft fingerprints everywhere you go. You don‚Äôt just look beautiful ‚Äî your heart is breathtaking."},
        {date:'2025-09-27', title:"Cozy Thought ‚òï", text:"The thought of being beside you makes me feel at peace. You make simple moments feel like treasures."},
        {date:'2025-09-28', title:"Joy Bringer üå∫", text:"You bring lightness into the room without even trying. Your presence is the kind of joy I never knew I needed."},
        {date:'2025-09-29', title:"My Secret Smile üåª", text:"You‚Äôre the reason behind the little smiles I give for no reason. Even when you‚Äôre not around, you‚Äôre with me."},
        {date:'2025-09-30', title:"Warmth Like Home üî•", text:"You feel like the coziest corner of the universe. With you, I‚Äôm warm in every way."},
        {date:'2025-10-01', title:"Quiet Strength üåä", text:"Your beauty is obvious, but your strength is even more stunning. You inspire me just by being you."},
        {date:'2025-10-02', title:"Your Melody üéµ", text:"Every word you say feels like a song I want on repeat. You don‚Äôt just speak ‚Äî you sing to my heart."},
        {date:'2025-10-03', title:"Little Brave Things üí´", text:"Your courage is in the way you stay kind in a world that isn‚Äôt always kind back. You‚Äôre stronger than you know."},
        {date:'2025-10-04', title:"Your Light üåû", text:"You make everything around you shine brighter. You‚Äôre more radiant than the sun on its best day."},
        {date:'2025-10-05', title:"Calm Waves üåä", text:"When life feels stormy, you are my calm sea. You‚Äôre my safe harbor and my peace."},
        {date:'2025-10-06', title:"Timeless You üåπ", text:"There‚Äôs a grace in you that feels timeless ‚Äî the kind of beauty and kindness that never fades."},
        {date:'2025-10-07', title:"Almost There ‚ú®", text:"Tomorrow is yours, and I can‚Äôt wait to celebrate everything about you. You‚Äôre my favorite day already."},
        {date:'2025-10-08', title:"üéÇ Happy Birthday, My Everything üßø‚ù§Ô∏è", text:"Today belongs to you ‚Äî but for me, every day does. Happy Birthday, love. You are my best wish come true.", confetti:true}
      ];

      const songs = [
        'music/2025-09-19.mp3','music/2025-09-20.mp3','music/2025-09-21.mp3','music/2025-09-22.mp3',
        'music/2025-09-23.mp3','music/2025-09-24.mp3','music/2025-09-25.mp3','music/2025-09-26.mp3','music/2025-09-27.mp3',
        'music/2025-09-28.mp3','music/2025-09-29.mp3','music/2025-09-30.mp3','music/2025-10-01.mp3',
        'music/2025-10-02.mp3','music/2025-10-03.mp3','music/2025-10-04.mp3','music/2025-10-05.mp3',
        'music/2025-10-06.mp3','music/2025-10-07.mp3','music/2025-10-08.mp3'
      ];

      const container = document.getElementById('notesContainer');
      const progressBar = document.getElementById('progressBar');
      const daysLeftEl = document.getElementById('daysLeft');
      const bgAudio = document.getElementById('bgAudio');
      const overlay = document.getElementById('birthdayOverlay');
      const emojiBg = document.querySelector('.emoji-bg');
      const debugPanel = document.getElementById('debugPanel');
      const musicIndicator = document.getElementById('musicIndicator');
      const todayStr = new Date().toISOString().split('T')[0];

      const confettiSafe = window.confetti ? window.confetti : function(opts){};

      // helper to update the header music indicator
      function updateMusicIndicator(){
        try{
          if(!musicIndicator) return;
          if(bgAudio && bgAudio.loop){ musicIndicator.classList.add('on'); }
          else { musicIndicator.classList.remove('on'); }
        }catch(e){console.warn('music ind err',e)}
      }

      // debug panel (visible if localhost or ?debug=1)
      function updateDebugPanel(){
        try{
          const show = (location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.search.includes('debug=1'));
          if(!debugPanel) return;
          if(show){
            debugPanel.style.display = 'block';
            const unlocked = notes.filter(n => (preview || todayStr >= n.date)).length;
            debugPanel.innerHTML = `today: ${todayStr}<br>preview: ${preview}<br>unlocked: ${unlocked}<br>audio.src: ${bgAudio.currentSrc||bgAudio.src||''}<br>looping: ${bgAudio.loop}`;
          } else { debugPanel.style.display = 'none'; }
        }catch(e){console.warn('dbg err',e)}
      }

      // scatter faint background emojis
      try{
        const bgEmojis = ["üíñ","üíï","üíò","üíû","üå∏","üåü","‚ú®"];
        if(emojiBg){
          for(let i=0;i<36;i++){
            const s=document.createElement('span');
            s.textContent = bgEmojis[Math.floor(Math.random()*bgEmojis.length)];
            s.style.left = Math.random()*100 + 'vw';
            s.style.top = Math.random()*100 + 'vh';
            s.style.fontSize = (16+Math.random()*26)+'px';
            s.style.animationDelay = (Math.random()*12)+'s';
            emojiBg.appendChild(s);
          }
        }
      }catch(e){console.warn('emoji bg failed',e)}

      function updateProgress(){
        const start = new Date('2025-09-19');
        const end = new Date('2025-10-08');
        const today = new Date();
        const total = Math.round((end - start) / (1000*60*60*24));
        const passed = Math.max(0, Math.min(total, Math.round((today - start)/(1000*60*60*24))));
        const pct = Math.round((passed / total) * 100);
        if(progressBar) progressBar.style.width = pct + '%';
        const left = Math.max(Math.round((end - today)/(1000*60*60*24)),0);
        if(daysLeftEl) daysLeftEl.textContent = left + ' day' + (left===1?'':'s');
        updateDebugPanel();
      }
      updateProgress();

      // play once helper
      function playSongImmediate(src){
        try{
          bgAudio.loop = bgAudio.loop || false; // safe
          if(!bgAudio.src || bgAudio.paused || (bgAudio.currentSrc && !bgAudio.currentSrc.includes(src))){
            bgAudio.src = src; bgAudio.volume = 0.35;
            const p = bgAudio.play();
            if(p && typeof p.then === 'function'){
              p.catch(err=>{ console.warn('Direct play blocked', err); });
            }
            updateDebugPanel(); updateMusicIndicator();
            return;
          }
        }catch(e){ console.log('playSongImmediate err', e); }
      }

      function fullScreenEmoji(list,count=40){
        for(let i=0;i<count;i++){
          const el=document.createElement('div'); el.className='emoji'; el.textContent=list[Math.floor(Math.random()*list.length)];
          const size=14+Math.random()*36; el.style.fontSize=size+'px';
          el.style.left=Math.random()*100+'vw'; el.style.top='-40px'; document.body.appendChild(el);
          const xMove=(Math.random()-0.5)*(innerWidth*0.6); const yMove=innerHeight+100; const rot=(Math.random()-0.5)*720;
          const duration=3+Math.random()*2;
          el.style.transition=`transform ${duration}s cubic-bezier(.2,.9,.3,1), opacity ${duration}s linear`;
          setTimeout(()=>{ el.style.transform=`translate(${xMove}px, ${yMove}px) rotate(${rot}deg)`; el.style.opacity=0; },30);
          setTimeout(()=>el.remove(),(duration*1000)+600);
        }
      }

      // build cards
      notes.forEach((note,idx)=>{
        const wrap=document.createElement('div'); wrap.className='cardWrap';
        const card=document.createElement('div'); card.className='card';
        const front=document.createElement('div'); front.className='face front';
        front.innerHTML=`<h3>${note.title}</h3><p style=\"font-weight:600;color:#888\">Tap to open</p>`;
        const back=document.createElement('div'); back.className='face back';
        back.innerHTML=`<h3>${note.title}</h3><p>${note.text}</p>`;
        card.appendChild(front); card.appendChild(back); wrap.appendChild(card);
        const badge=document.createElement('div'); badge.className='badge';
        const unlocked=preview ? true : (todayStr >= note.date);
        badge.textContent=unlocked?'Open':'Locked'; card.appendChild(badge);
        if(unlocked){
          card.addEventListener('click',()=>{
            if(card.classList.contains('flipped')) return;
            card.classList.add('flipped');

            // loop automatically if this is today's card
            if(note.date === todayStr){ bgAudio.loop = true; } else { bgAudio.loop = false; }

            if(note.confetti){
              fullScreenEmoji(['üíñ','üíï','üíò','üíû','üíü'],120);
              overlay.classList.add('show');
              const duration=3000; const interval=450; let elapsed=0;
              const timer=setInterval(()=>{ confettiSafe({particleCount:220,spread:160}); elapsed+=interval; if(elapsed>=duration) clearInterval(timer); },interval);
              setTimeout(()=>overlay.classList.remove('show'),duration+800);
            } else {
              fullScreenEmoji(['üíñ','üíï','üíò','üíû','üíü'],28);
            }

            playSongImmediate(songs[idx]);
            updateMusicIndicator(); updateDebugPanel();
            updateProgress();
          });
        } else {
          card.classList.add('locked');
        }
        container.appendChild(wrap);
      });

      // audio event listeners to keep indicator in sync
      try{
        bgAudio.addEventListener('play', ()=>{ updateMusicIndicator(); updateDebugPanel(); });
        bgAudio.addEventListener('pause', ()=>{ updateMusicIndicator(); updateDebugPanel(); });
        bgAudio.addEventListener('ended', ()=>{ updateMusicIndicator(); updateDebugPanel(); });
        bgAudio.addEventListener('error', (e)=>{ console.error('bgAudio error', e); updateDebugPanel(); });
      }catch(e){console.warn('audio listeners failed',e)}

      // initial debug update
      updateDebugPanel();

    }catch(err){
      console.error('Initialization error', err);
    }
  });
</script>
</body>
</html>
